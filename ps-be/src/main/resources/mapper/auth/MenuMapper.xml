<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jiuxi.infra.auth.persistence.mapper.MenuMapper">

    <!-- 菜单结果映射 -->
    <resultMap type="com.jiuxi.infra.auth.persistence.entity.MenuPO" id="menuMap">
        <result property="id" column="id"/>
        <result property="menuCode" column="menu_code"/>
        <result property="menuName" column="menu_name"/>
        <result property="menuTitle" column="menu_title"/>
        <result property="parentMenuId" column="parent_menu_id"/>
        <result property="menuPath" column="menu_path"/>
        <result property="menuLevel" column="menu_level"/>
        <result property="menuType" column="menu_type"/>
        <result property="menuUri" column="menu_uri"/>
        <result property="menuIcon" column="menu_icon"/>
        <result property="component" column="component"/>
        <result property="status" column="status"/>
        <result property="visible" column="visible"/>
        <result property="keepAlive" column="keep_alive"/>
        <result property="external" column="external"/>
        <result property="leaf" column="leaf"/>
        <result property="orderIndex" column="order_index"/>
        <result property="creator" column="creator"/>
        <result property="createTime" column="create_time"/>
        <result property="updator" column="updator"/>
        <result property="updateTime" column="update_time"/>
        <result property="tenantId" column="tenant_id"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

    <!-- 插入菜单 -->
    <insert id="insert" parameterType="com.jiuxi.infra.auth.persistence.entity.MenuPO">
        INSERT INTO sys_menu
            (id, menu_code, menu_name, menu_title, parent_menu_id, menu_path, menu_level, menu_type, menu_uri, menu_icon, component, status, visible, keep_alive, external, leaf, order_index, creator, create_time, updator, update_time, tenant_id, deleted)
        VALUES
            (#{id}, #{menuCode}, #{menuName}, #{menuTitle}, #{parentMenuId}, #{menuPath}, #{menuLevel}, #{menuType}, #{menuUri}, #{menuIcon}, #{component}, #{status}, #{visible}, #{keepAlive}, #{external}, #{leaf}, #{orderIndex}, #{creator}, #{createTime}, #{updator}, #{updateTime}, #{tenantId}, #{deleted})
    </insert>

    <!-- 更新菜单 -->
    <update id="updateById" parameterType="com.jiuxi.infra.auth.persistence.entity.MenuPO">
        UPDATE sys_menu
        <set>
            <if test="menuCode != null and menuCode != ''">menu_code = #{menuCode},</if>
            <if test="menuName != null and menuName != ''">menu_name = #{menuName},</if>
            <if test="menuTitle != null and menuTitle != ''">menu_title = #{menuTitle},</if>
            <if test="parentMenuId != null">parent_menu_id = #{parentMenuId},</if>
            <if test="menuPath != null">menu_path = #{menuPath},</if>
            <if test="menuLevel != null">menu_level = #{menuLevel},</if>
            <if test="menuType != null">menu_type = #{menuType},</if>
            <if test="menuUri != null">menu_uri = #{menuUri},</if>
            <if test="menuIcon != null">menu_icon = #{menuIcon},</if>
            <if test="component != null">component = #{component},</if>
            <if test="status != null">status = #{status},</if>
            <if test="visible != null">visible = #{visible},</if>
            <if test="keepAlive != null">keep_alive = #{keepAlive},</if>
            <if test="external != null">external = #{external},</if>
            <if test="leaf != null">leaf = #{leaf},</if>
            <if test="orderIndex != null">order_index = #{orderIndex},</if>
            <if test="updator != null">updator = #{updator},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="tenantId != null">tenant_id = #{tenantId},</if>
            deleted = #{deleted}
        </set>
        WHERE id = #{id}
    </update>

    <!-- 根据ID查询菜单 -->
    <select id="selectById" parameterType="String" resultMap="menuMap">
        SELECT id, menu_code, menu_name, menu_title, parent_menu_id, menu_path, menu_level, menu_type, menu_uri, menu_icon, component, status, visible, keep_alive, external, leaf, order_index, creator, create_time, updator, update_time, tenant_id, deleted
        FROM sys_menu
        WHERE id = #{id} AND deleted = 0
    </select>

    <!-- 根据条件查询单个菜单 -->
    <select id="selectOne" parameterType="com.baomidou.mybatisplus.core.conditions.query.QueryWrapper" resultMap="menuMap">
        SELECT id, menu_code, menu_name, menu_title, parent_menu_id, menu_path, menu_level, menu_type, menu_uri, menu_icon, component, status, visible, keep_alive, external, leaf, order_index, creator, create_time, updator, update_time, tenant_id, deleted
        FROM sys_menu
        <where>
            deleted = 0
            <if test="ew != null and ew.sqlSegment != null and ew.sqlSegment != ''">
                AND ${ew.sqlSegment}
            </if>
        </where>
    </select>

    <!-- 根据ID删除菜单（逻辑删除） -->
    <update id="deleteById" parameterType="String">
        UPDATE sys_menu
        SET deleted = 1
        WHERE id = #{id}
    </update>

</mapper>