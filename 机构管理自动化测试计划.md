# æœºæ„ç®¡ç†æ¨¡å—è‡ªåŠ¨åŒ–æµ‹è¯•è®¡åˆ’

## 1. æµ‹è¯•æ¦‚è¿°

### 1.1 æµ‹è¯•ç›®æ ‡
æœ¬æµ‹è¯•è®¡åˆ’æ—¨åœ¨å¯¹"ç»„ç»‡ç®¡ç†"æ¨¡å—ä¸­çš„"æœºæ„ç®¡ç†"åŠŸèƒ½è¿›è¡Œå…¨é¢çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€å¯é æ€§å’Œæ€§èƒ½è¡¨ç°ã€‚

### 1.2 æµ‹è¯•èŒƒå›´
- **æ ¸å¿ƒåŠŸèƒ½**ï¼šæœºæ„çš„æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤ã€æŸ¥è¯¢æ“ä½œ
- **å­—æ®µéªŒè¯**ï¼šæ‰€æœ‰æœºæ„ç›¸å…³å­—æ®µçš„è¾“å…¥éªŒè¯å’Œä¸šåŠ¡è§„åˆ™éªŒè¯
- **ç•Œé¢äº¤äº’**ï¼šå‰ç«¯é¡µé¢çš„ç”¨æˆ·äº¤äº’å’Œæ•°æ®å±•ç¤º
- **æ•°æ®å…³è”**ï¼šæœºæ„ä¸äººå‘˜ã€éƒ¨é—¨ç­‰å…¶ä»–æ¨¡å—çš„å…³è”å…³ç³»
- **æ€§èƒ½æµ‹è¯•**ï¼šå¤§æ•°æ®é‡ä¸‹çš„æ“ä½œå“åº”æ—¶é—´
- **å®‰å…¨æµ‹è¯•**ï¼šæƒé™æ§åˆ¶å’Œæ•°æ®å®‰å…¨éªŒè¯

### 1.3 æµ‹è¯•ç¯å¢ƒ
- **åç«¯æœåŠ¡**ï¼šhttp://localhost:8082/ps-be
- **å‰ç«¯åº”ç”¨**ï¼šhttp://localhost:10801
- **æ•°æ®åº“**ï¼šMariaDB (alilaoba.cn:13307/ps-bmp)
- **æµ‹è¯•æ¡†æ¶**ï¼šJest + Selenium WebDriver

## 2. åŠŸèƒ½æ¨¡å—åˆ†æ

### 2.1 åç«¯APIæ¥å£
åŸºäº `TpDeptBasicinfoController` åˆ†æçš„æ ¸å¿ƒæ¥å£ï¼š

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½æè¿° | å‚æ•° |
|---------|------|----------|------|
| `/sys/dept/org/tree` | GET | è·å–æœºæ„æ ‘ | deptId, jwtdid, sync |
| `/sys/dept/org/add` | POST | æ·»åŠ æ”¿åºœæœºæ„ | TpDeptBasicinfoVO, jwtpid |
| `/sys/dept/ent/add` | POST | æ·»åŠ ä¼ä¸šæœºæ„ | TpDeptBasicinfoVO, jwtpid |
| `/sys/dept/view` | GET | æŸ¥è¯¢æœºæ„ä¿¡æ¯ | deptId, jwtpid, jwtaid |
| `/sys/dept/update` | POST | ä¿®æ”¹æœºæ„ä¿¡æ¯ | TpDeptBasicinfoVO, jwtpid |
| `/sys/dept/delete` | POST | åˆ é™¤æœºæ„ | deptId, jwtpid |
| `/sys/dept/children` | GET | æŸ¥è¯¢ä¸‹çº§æœºæ„ | parentId, deptType, filterCommAscn, category |

### 2.2 æ ¸å¿ƒå­—æ®µç»“æ„
åŸºäº `TpDeptBasicinfoVO` çš„å­—æ®µåˆ†æï¼š

| å­—æ®µå | ç±»å‹ | å¿…å¡« | æè¿° | éªŒè¯è§„åˆ™ |
|--------|------|------|------|----------|
| deptFullName | String | æ˜¯ | æœºæ„å…¨ç§° | é•¿åº¦1-100å­—ç¬¦ |
| deptSimpleName | String | æ˜¯ | æœºæ„ç®€ç§° | é•¿åº¦1-50å­—ç¬¦ |
| deptNo | String | å¦ | æœºæ„ç¼–å· | å”¯ä¸€æ€§éªŒè¯ |
| deptType | String | æ˜¯ | æœºæ„ç±»å‹ | å­—å…¸å€¼éªŒè¯ |
| principalName | String | å¦ | è´Ÿè´£äººå§“å | é•¿åº¦1-20å­—ç¬¦ |
| principalTel | String | å¦ | è´Ÿè´£äººç”µè¯ | æ‰‹æœºå·æ ¼å¼éªŒè¯ |
| orderIndex | Integer | å¦ | æ’åºå· | æ•°å€¼èŒƒå›´éªŒè¯ |
| cityCode | String | æ˜¯ | è¡Œæ”¿åŒºåˆ’ä»£ç  | æœ‰æ•ˆåŒºåˆ’éªŒè¯ |
| enabled | Integer | å¦ | æ˜¯å¦å¯ç”¨ | 0æˆ–1 |
| deptDesc | String | å¦ | æœºæ„æè¿° | æœ€å¤§200å­—ç¬¦ |

## 3. è¯¦ç»†æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### 3.1 æœºæ„æ–°å¢åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

#### TC001: æ”¿åºœæœºæ„æ–°å¢-æ­£å¸¸æµç¨‹
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æ”¿åºœæœºæ„æ–°å¢çš„æ­£å¸¸ä¸šåŠ¡æµç¨‹
**å‰ç½®æ¡ä»¶**ï¼šç”¨æˆ·å·²ç™»å½•ï¼Œå…·æœ‰æœºæ„æ–°å¢æƒé™
**æµ‹è¯•æ­¥éª¤**ï¼š
1. è®¿é—®æœºæ„ç®¡ç†é¡µé¢
2. ç‚¹å‡»"æ·»åŠ åŒçº§"æˆ–"æ·»åŠ ä¸‹çº§"æŒ‰é’®
3. å¡«å†™å®Œæ•´çš„æœºæ„ä¿¡æ¯
4. ç‚¹å‡»"ä¿å­˜åŸºæœ¬ä¿¡æ¯"æŒ‰é’®
**æµ‹è¯•æ•°æ®**ï¼š
```json
{
  "deptFullName": "æµ‹è¯•æ”¿åºœæœºæ„å…¨ç§°",
  "deptSimpleName": "æµ‹è¯•æœºæ„",
  "deptNo": "TEST001",
  "deptType": "01",
  "principalName": "å¼ ä¸‰",
  "principalTel": "13800138000",
  "orderIndex": 1,
  "cityCode": "110000",
  "enabled": 1,
  "deptDesc": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æœºæ„"
}
```
**é¢„æœŸç»“æœ**ï¼šæœºæ„åˆ›å»ºæˆåŠŸï¼Œè¿”å›æˆåŠŸå“åº”ï¼Œæœºæ„æ ‘æ›´æ–°
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC002: ä¼ä¸šæœºæ„æ–°å¢-æ­£å¸¸æµç¨‹
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯ä¼ä¸šæœºæ„æ–°å¢çš„æ­£å¸¸ä¸šåŠ¡æµç¨‹
**å‰ç½®æ¡ä»¶**ï¼šç”¨æˆ·å·²ç™»å½•ï¼Œå…·æœ‰æœºæ„æ–°å¢æƒé™
**æµ‹è¯•æ­¥éª¤**ï¼š
1. è®¿é—®æœºæ„ç®¡ç†é¡µé¢
2. åˆ‡æ¢åˆ°ä¼ä¸šæœºæ„æ¨¡å¼
3. ç‚¹å‡»"æ·»åŠ åŒçº§"æˆ–"æ·»åŠ ä¸‹çº§"æŒ‰é’®
4. å¡«å†™å®Œæ•´çš„æœºæ„ä¿¡æ¯
5. ç‚¹å‡»"ä¿å­˜åŸºæœ¬ä¿¡æ¯"æŒ‰é’®
**æµ‹è¯•æ•°æ®**ï¼š
```json
{
  "deptFullName": "æµ‹è¯•ä¼ä¸šæœºæ„å…¨ç§°",
  "deptSimpleName": "æµ‹è¯•ä¼ä¸š",
  "deptNo": "ENT001",
  "deptType": "02",
  "principalName": "æå››",
  "principalTel": "13900139000",
  "orderIndex": 2,
  "cityCode": "110000",
  "enabled": 1,
  "deptDesc": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä¼ä¸šæœºæ„"
}
```
**é¢„æœŸç»“æœ**ï¼šä¼ä¸šæœºæ„åˆ›å»ºæˆåŠŸï¼Œè¿”å›æˆåŠŸå“åº”
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

### 3.2 å­—æ®µéªŒè¯æµ‹è¯•ç”¨ä¾‹

#### TC003: å¿…å¡«å­—æ®µéªŒè¯
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯å¿…å¡«å­—æ®µçš„éªŒè¯è§„åˆ™
**æµ‹è¯•æ­¥éª¤**ï¼š
1. è®¿é—®æœºæ„æ–°å¢é¡µé¢
2. ä¸å¡«å†™å¿…å¡«å­—æ®µï¼Œç›´æ¥æäº¤
3. éªŒè¯é”™è¯¯æç¤ºä¿¡æ¯
**æµ‹è¯•æ•°æ®**ï¼š
- æœºæ„å…¨ç§°ä¸ºç©º
- æœºæ„ç®€ç§°ä¸ºç©º
- æœºæ„ç±»å‹ä¸ºç©º
- è¡Œæ”¿åŒºåˆ’ä¸ºç©º
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤ºç›¸åº”çš„å¿…å¡«å­—æ®µé”™è¯¯æç¤º
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC004: å­—æ®µé•¿åº¦è¾¹ç•Œæµ‹è¯•
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯å­—æ®µé•¿åº¦é™åˆ¶
**æµ‹è¯•æ•°æ®**ï¼š
- æœºæ„å…¨ç§°ï¼š101ä¸ªå­—ç¬¦ï¼ˆè¶…å‡ºé™åˆ¶ï¼‰
- æœºæ„ç®€ç§°ï¼š51ä¸ªå­—ç¬¦ï¼ˆè¶…å‡ºé™åˆ¶ï¼‰
- è´Ÿè´£äººå§“åï¼š21ä¸ªå­—ç¬¦ï¼ˆè¶…å‡ºé™åˆ¶ï¼‰
- æœºæ„æè¿°ï¼š201ä¸ªå­—ç¬¦ï¼ˆè¶…å‡ºé™åˆ¶ï¼‰
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤ºå­—æ®µé•¿åº¦è¶…å‡ºé™åˆ¶çš„é”™è¯¯æç¤º
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC005: ç‰¹æ®Šå­—ç¬¦éªŒè¯
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯ç‰¹æ®Šå­—ç¬¦çš„å¤„ç†
**æµ‹è¯•æ•°æ®**ï¼š
- æœºæ„å…¨ç§°åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼š`<script>alert('test')</script>`
- æœºæ„ç¼–å·åŒ…å«SQLæ³¨å…¥ï¼š`'; DROP TABLE tp_dept_basicinfo; --`
**é¢„æœŸç»“æœ**ï¼šç‰¹æ®Šå­—ç¬¦è¢«æ­£ç¡®è½¬ä¹‰æˆ–æ‹’ç»
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC006: ç”µè¯å·ç æ ¼å¼éªŒè¯
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯ç”µè¯å·ç æ ¼å¼
**æµ‹è¯•æ•°æ®**ï¼š
- æœ‰æ•ˆæ‰‹æœºå·ï¼š13800138000
- æ— æ•ˆæ‰‹æœºå·ï¼š12345
- å›ºå®šç”µè¯ï¼š010-12345678
**é¢„æœŸç»“æœ**ï¼šåªæ¥å—æœ‰æ•ˆçš„ç”µè¯å·ç æ ¼å¼
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

### 3.3 æœºæ„æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

#### TC007: æœºæ„æ ‘æŸ¥è¯¢
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æœºæ„æ ‘çš„æ­£ç¡®åŠ è½½å’Œå±•ç¤º
**æµ‹è¯•æ­¥éª¤**ï¼š
1. è®¿é—®æœºæ„ç®¡ç†é¡µé¢
2. éªŒè¯æœºæ„æ ‘çš„åŠ è½½
3. å±•å¼€/æ”¶èµ·èŠ‚ç‚¹
4. é€‰æ‹©ä¸åŒèŠ‚ç‚¹
**é¢„æœŸç»“æœ**ï¼šæœºæ„æ ‘æ­£ç¡®åŠ è½½ï¼ŒèŠ‚ç‚¹æ“ä½œæ­£å¸¸
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC008: æœºæ„è¯¦æƒ…æŸ¥è¯¢
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æœºæ„è¯¦æƒ…ä¿¡æ¯çš„æ­£ç¡®æ˜¾ç¤º
**æµ‹è¯•æ­¥éª¤**ï¼š
1. åœ¨æœºæ„æ ‘ä¸­é€‰æ‹©ä¸€ä¸ªæœºæ„èŠ‚ç‚¹
2. éªŒè¯å³ä¾§è¯¦æƒ…é¢æ¿çš„ä¿¡æ¯æ˜¾ç¤º
**é¢„æœŸç»“æœ**ï¼šæœºæ„è¯¦æƒ…ä¿¡æ¯å®Œæ•´æ­£ç¡®æ˜¾ç¤º
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

### 3.4 æœºæ„ç¼–è¾‘åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

#### TC009: æœºæ„ä¿¡æ¯ä¿®æ”¹-æ­£å¸¸æµç¨‹
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æœºæ„ä¿¡æ¯ä¿®æ”¹åŠŸèƒ½
**å‰ç½®æ¡ä»¶**ï¼šå­˜åœ¨å¯ç¼–è¾‘çš„æœºæ„è®°å½•
**æµ‹è¯•æ­¥éª¤**ï¼š
1. é€‰æ‹©è¦ä¿®æ”¹çš„æœºæ„
2. ç‚¹å‡»"ä¿®æ”¹"æŒ‰é’®
3. ä¿®æ”¹æœºæ„ä¿¡æ¯
4. ä¿å­˜ä¿®æ”¹
**æµ‹è¯•æ•°æ®**ï¼šä¿®æ”¹æœºæ„å…¨ç§°ã€ç®€ç§°ã€æè¿°ç­‰ä¿¡æ¯
**é¢„æœŸç»“æœ**ï¼šæœºæ„ä¿¡æ¯ä¿®æ”¹æˆåŠŸï¼Œæ˜¾ç¤ºæ›´æ–°åçš„ä¿¡æ¯
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC010: æœºæ„ç¼–å·å”¯ä¸€æ€§éªŒè¯
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æœºæ„ç¼–å·çš„å”¯ä¸€æ€§çº¦æŸ
**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºæœºæ„Aï¼Œç¼–å·ä¸º"TEST001"
2. å°è¯•åˆ›å»ºæœºæ„Bï¼Œä½¿ç”¨ç›¸åŒç¼–å·"TEST001"
**é¢„æœŸç»“æœ**ï¼šç³»ç»Ÿæç¤ºç¼–å·é‡å¤é”™è¯¯
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

### 3.5 æœºæ„åˆ é™¤åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

#### TC011: æœºæ„åˆ é™¤-æ— å…³è”æ•°æ®
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯åˆ é™¤æ— å…³è”æ•°æ®çš„æœºæ„
**å‰ç½®æ¡ä»¶**ï¼šå­˜åœ¨æ— äººå‘˜å…³è”çš„æœºæ„
**æµ‹è¯•æ­¥éª¤**ï¼š
1. é€‰æ‹©è¦åˆ é™¤çš„æœºæ„
2. ç‚¹å‡»"åˆ é™¤æœ¬çº§"æŒ‰é’®
3. ç¡®è®¤åˆ é™¤æ“ä½œ
**é¢„æœŸç»“æœ**ï¼šæœºæ„åˆ é™¤æˆåŠŸï¼Œä»æœºæ„æ ‘ä¸­ç§»é™¤
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC012: æœºæ„åˆ é™¤-æœ‰å…³è”æ•°æ®
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯åˆ é™¤æœ‰äººå‘˜å…³è”çš„æœºæ„æ—¶çš„æç¤º
**å‰ç½®æ¡ä»¶**ï¼šå­˜åœ¨æœ‰äººå‘˜å…³è”çš„æœºæ„
**æµ‹è¯•æ­¥éª¤**ï¼š
1. é€‰æ‹©æœ‰äººå‘˜å…³è”çš„æœºæ„
2. ç‚¹å‡»"åˆ é™¤æœ¬çº§"æŒ‰é’®
**é¢„æœŸç»“æœ**ï¼šç³»ç»Ÿæç¤ºè¯¥æœºæ„æœ‰å…³è”äººå‘˜ï¼Œè¯¢é—®æ˜¯å¦ç¡®å®šåˆ é™¤
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

### 3.6 æ•°æ®å…³è”æµ‹è¯•ç”¨ä¾‹

#### TC013: æœºæ„ä¸äººå‘˜å…³è”éªŒè¯
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æœºæ„ä¸äººå‘˜çš„å…³è”å…³ç³»
**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºæœºæ„
2. ä¸ºæœºæ„åˆ†é…äººå‘˜
3. éªŒè¯å…³è”å…³ç³»çš„æ­£ç¡®æ€§
**é¢„æœŸç»“æœ**ï¼šæœºæ„ä¸äººå‘˜å…³è”å…³ç³»æ­£ç¡®å»ºç«‹
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC014: æœºæ„å±‚çº§å…³ç³»éªŒè¯
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æœºæ„çš„å±‚çº§å…³ç³»
**æµ‹è¯•æ­¥éª¤**ï¼š
1. åˆ›å»ºçˆ¶çº§æœºæ„
2. åœ¨çˆ¶çº§æœºæ„ä¸‹åˆ›å»ºå­çº§æœºæ„
3. éªŒè¯å±‚çº§å…³ç³»çš„æ­£ç¡®æ€§
**é¢„æœŸç»“æœ**ï¼šæœºæ„å±‚çº§å…³ç³»æ­£ç¡®å»ºç«‹å’Œæ˜¾ç¤º
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

### 3.7 æ€§èƒ½æµ‹è¯•ç”¨ä¾‹

#### TC015: å¤§æ•°æ®é‡æœºæ„æ ‘åŠ è½½æ€§èƒ½
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯å¤§æ•°æ®é‡ä¸‹æœºæ„æ ‘çš„åŠ è½½æ€§èƒ½
**æµ‹è¯•æ•°æ®**ï¼šåˆ›å»º1000ä¸ªæœºæ„èŠ‚ç‚¹
**æ€§èƒ½æŒ‡æ ‡**ï¼š
- æœºæ„æ ‘åŠ è½½æ—¶é—´ < 3ç§’
- èŠ‚ç‚¹å±•å¼€å“åº”æ—¶é—´ < 1ç§’
**é¢„æœŸç»“æœ**ï¼šåœ¨è§„å®šæ—¶é—´å†…å®ŒæˆåŠ è½½
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC016: æ‰¹é‡æ“ä½œæ€§èƒ½æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æ‰¹é‡åˆ›å»ºæœºæ„çš„æ€§èƒ½
**æµ‹è¯•æ•°æ®**ï¼šæ‰¹é‡åˆ›å»º100ä¸ªæœºæ„
**æ€§èƒ½æŒ‡æ ‡**ï¼šå¹³å‡åˆ›å»ºæ—¶é—´ < 500ms/ä¸ª
**é¢„æœŸç»“æœ**ï¼šæ‰¹é‡æ“ä½œåœ¨å¯æ¥å—æ—¶é—´å†…å®Œæˆ
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

### 3.8 å®‰å…¨æ€§æµ‹è¯•ç”¨ä¾‹

#### TC017: æƒé™æ§åˆ¶éªŒè¯
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æœºæ„ç®¡ç†çš„æƒé™æ§åˆ¶
**æµ‹è¯•æ­¥éª¤**ï¼š
1. ä½¿ç”¨æ— æƒé™ç”¨æˆ·ç™»å½•
2. å°è¯•è®¿é—®æœºæ„ç®¡ç†åŠŸèƒ½
**é¢„æœŸç»“æœ**ï¼šç³»ç»Ÿæ‹’ç»è®¿é—®æˆ–éšè—ç›¸å…³åŠŸèƒ½æŒ‰é’®
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC018: SQLæ³¨å…¥é˜²æŠ¤æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯ç³»ç»Ÿå¯¹SQLæ³¨å…¥çš„é˜²æŠ¤
**æµ‹è¯•æ•°æ®**ï¼šåœ¨å„ä¸ªè¾“å…¥å­—æ®µä¸­è¾“å…¥SQLæ³¨å…¥ä»£ç 
**é¢„æœŸç»“æœ**ï¼šç³»ç»Ÿæ­£ç¡®å¤„ç†ï¼Œä¸æ‰§è¡Œæ¶æ„SQL
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC019: XSSæ”»å‡»é˜²æŠ¤æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯ç³»ç»Ÿå¯¹XSSæ”»å‡»çš„é˜²æŠ¤
**æµ‹è¯•æ•°æ®**ï¼šåœ¨è¾“å…¥å­—æ®µä¸­è¾“å…¥JavaScriptä»£ç 
**é¢„æœŸç»“æœ**ï¼šç³»ç»Ÿæ­£ç¡®è½¬ä¹‰ï¼Œä¸æ‰§è¡Œæ¶æ„è„šæœ¬
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

#### TC020: æ•°æ®ä¼ è¾“å®‰å…¨æµ‹è¯•
**æµ‹è¯•ç›®æ ‡**ï¼šéªŒè¯æ•æ„Ÿæ•°æ®çš„ä¼ è¾“å®‰å…¨
**æµ‹è¯•æ­¥éª¤**ï¼š
1. ç›‘æ§ç½‘ç»œè¯·æ±‚
2. éªŒè¯æ•æ„Ÿæ•°æ®æ˜¯å¦åŠ å¯†ä¼ è¾“
**é¢„æœŸç»“æœ**ï¼šæ•æ„Ÿæ•°æ®ç»è¿‡åŠ å¯†å¤„ç†
**å®é™…ç»“æœ**ï¼š[å¾…å¡«å†™]

## 4. è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬è®¾è®¡

### 4.1 æµ‹è¯•æ¡†æ¶é€‰æ‹©
- **å‰ç«¯è‡ªåŠ¨åŒ–**ï¼šSelenium WebDriver + Jest
- **APIæµ‹è¯•**ï¼šJest + Axios
- **æ€§èƒ½æµ‹è¯•**ï¼šArtillery.js
- **æ•°æ®åº“æµ‹è¯•**ï¼šJest + MySQL2

### 4.2 è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ç¤ºä¾‹

#### 4.2.1 APIæµ‹è¯•è„šæœ¬
```javascript
// æœºæ„ç®¡ç†APIè‡ªåŠ¨åŒ–æµ‹è¯•
const axios = require('axios');
const { expect } = require('@jest/globals');

const BASE_URL = 'http://localhost:8082/ps-be';
const API_ENDPOINTS = {
  orgAdd: '/sys/dept/org/add',
  orgTree: '/sys/dept/org/tree',
  deptView: '/sys/dept/view',
  deptUpdate: '/sys/dept/update',
  deptDelete: '/sys/dept/delete'
};

// æµ‹è¯•æ•°æ®
const testOrgData = {
  deptFullName: 'è‡ªåŠ¨åŒ–æµ‹è¯•æœºæ„å…¨ç§°',
  deptSimpleName: 'è‡ªåŠ¨åŒ–æµ‹è¯•æœºæ„',
  deptNo: 'AUTO_TEST_001',
  deptType: '01',
  principalName: 'æµ‹è¯•è´Ÿè´£äºº',
  principalTel: '13800138000',
  orderIndex: 1,
  cityCode: '110000',
  enabled: 1,
  deptDesc: 'è¿™æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•åˆ›å»ºçš„æœºæ„'
};

describe('æœºæ„ç®¡ç†APIæµ‹è¯•', () => {
  let createdOrgId = null;
  let authToken = null;

  beforeAll(async () => {
    // è·å–è®¤è¯token
    authToken = await getAuthToken();
  });

  afterAll(async () => {
    // æ¸…ç†æµ‹è¯•æ•°æ®
    if (createdOrgId) {
      await cleanupTestData(createdOrgId);
    }
  });

  test('TC001: æ”¿åºœæœºæ„æ–°å¢-æ­£å¸¸æµç¨‹', async () => {
    const response = await axios.post(
      `${BASE_URL}${API_ENDPOINTS.orgAdd}`,
      testOrgData,
      {
        headers: {
          'Authorization': `Bearer ${authToken}`,
          'Content-Type': 'application/json'
        },
        params: {
          jwtpid: 'test_user_id'
        }
      }
    );

    expect(response.status).toBe(200);
    expect(response.data.success).toBe(true);
    expect(response.data.data).toHaveProperty('id');
    
    createdOrgId = response.data.data.id;
  });

  test('TC003: å¿…å¡«å­—æ®µéªŒè¯', async () => {
    const invalidData = { ...testOrgData };
    delete invalidData.deptFullName;
    delete invalidData.deptSimpleName;

    try {
      await axios.post(
        `${BASE_URL}${API_ENDPOINTS.orgAdd}`,
        invalidData,
        {
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          },
          params: {
            jwtpid: 'test_user_id'
          }
        }
      );
    } catch (error) {
      expect(error.response.status).toBe(400);
      expect(error.response.data.success).toBe(false);
    }
  });

  test('TC007: æœºæ„æ ‘æŸ¥è¯¢', async () => {
    const response = await axios.get(
      `${BASE_URL}${API_ENDPOINTS.orgTree}`,
      {
        headers: {
          'Authorization': `Bearer ${authToken}`
        },
        params: {
          deptId: '',
          jwtdid: 'test_dept_id',
          sync: 1
        }
      }
    );

    expect(response.status).toBe(200);
    expect(response.data.success).toBe(true);
    expect(Array.isArray(response.data.data)).toBe(true);
  });
});

// è¾…åŠ©å‡½æ•°
async function getAuthToken() {
  // å®ç°è·å–è®¤è¯tokençš„é€»è¾‘
  return 'mock_auth_token';
}

async function cleanupTestData(orgId) {
  // å®ç°æ¸…ç†æµ‹è¯•æ•°æ®çš„é€»è¾‘
  try {
    await axios.post(
      `${BASE_URL}${API_ENDPOINTS.deptDelete}`,
      null,
      {
        params: {
          deptId: orgId,
          jwtpid: 'test_user_id'
        }
      }
    );
  } catch (error) {
    console.warn('æ¸…ç†æµ‹è¯•æ•°æ®å¤±è´¥:', error.message);
  }
}
```

#### 4.2.2 å‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
```javascript
// æœºæ„ç®¡ç†å‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•
const { Builder, By, until } = require('selenium-webdriver');
const { expect } = require('@jest/globals');

const FRONTEND_URL = 'http://localhost:10801';
const TIMEOUT = 10000;

describe('æœºæ„ç®¡ç†å‰ç«¯UIæµ‹è¯•', () => {
  let driver;

  beforeAll(async () => {
    driver = await new Builder().forBrowser('chrome').build();
    await driver.manage().window().maximize();
    
    // ç™»å½•ç³»ç»Ÿ
    await loginToSystem(driver);
  });

  afterAll(async () => {
    if (driver) {
      await driver.quit();
    }
  });

  test('TC001: æœºæ„æ–°å¢é¡µé¢æ‰“å¼€', async () => {
    // å¯¼èˆªåˆ°æœºæ„ç®¡ç†é¡µé¢
    await driver.get(`${FRONTEND_URL}/#/sys/dept/org/tree`);
    
    // ç­‰å¾…é¡µé¢åŠ è½½
    await driver.wait(until.elementLocated(By.css('.fb-page-tree')), TIMEOUT);
    
    // ç‚¹å‡»æ·»åŠ æŒ‰é’®
    const addButton = await driver.findElement(By.css('[icon="node"]'));
    await addButton.click();
    
    // éªŒè¯å¼¹çª—æ‰“å¼€
    await driver.wait(until.elementLocated(By.css('.tp-dialog')), TIMEOUT);
    
    const dialogTitle = await driver.findElement(By.css('.tp-dialog .fb-form'));
    expect(await dialogTitle.isDisplayed()).toBe(true);
  });

  test('TC002: æœºæ„ä¿¡æ¯å¡«å†™å’Œæäº¤', async () => {
    // å¡«å†™æœºæ„å…¨ç§°
    const fullNameInput = await driver.findElement(
      By.css('input[placeholder="è¯·è¾“å…¥éƒ¨é—¨å…¨ç§°"]')
    );
    await fullNameInput.clear();
    await fullNameInput.sendKeys('UIè‡ªåŠ¨åŒ–æµ‹è¯•æœºæ„');
    
    // å¡«å†™æœºæ„ç®€ç§°
    const simpleNameInput = await driver.findElement(
      By.css('input[placeholder="è¯·è¾“å…¥éƒ¨é—¨ç®€ç§°"]')
    );
    await simpleNameInput.clear();
    await simpleNameInput.sendKeys('UIæµ‹è¯•æœºæ„');
    
    // é€‰æ‹©æœºæ„ç±»å‹
    const deptTypeSelect = await driver.findElement(
      By.css('fb-select[placeholder="è¯·é€‰æ‹©"]')
    );
    await deptTypeSelect.click();
    
    // ç­‰å¾…ä¸‹æ‹‰é€‰é¡¹å‡ºç°å¹¶é€‰æ‹©
    await driver.wait(until.elementLocated(By.css('.fb-select-option')), TIMEOUT);
    const firstOption = await driver.findElement(By.css('.fb-select-option:first-child'));
    await firstOption.click();
    
    // ç‚¹å‡»ä¿å­˜æŒ‰é’®
    const saveButton = await driver.findElement(
      By.css('fb-button[type="primary"]')
    );
    await saveButton.click();
    
    // éªŒè¯ä¿å­˜æˆåŠŸï¼ˆå¯ä»¥é€šè¿‡æˆåŠŸæç¤ºæˆ–é¡µé¢è·³è½¬æ¥éªŒè¯ï¼‰
    await driver.sleep(2000); // ç­‰å¾…ä¿å­˜å®Œæˆ
  });

  test('TC003: å­—æ®µéªŒè¯æµ‹è¯•', async () => {
    // æ¸…ç©ºå¿…å¡«å­—æ®µ
    const fullNameInput = await driver.findElement(
      By.css('input[placeholder="è¯·è¾“å…¥éƒ¨é—¨å…¨ç§°"]')
    );
    await fullNameInput.clear();
    
    // å°è¯•æäº¤
    const saveButton = await driver.findElement(
      By.css('fb-button[type="primary"]')
    );
    await saveButton.click();
    
    // éªŒè¯é”™è¯¯æç¤º
    await driver.wait(until.elementLocated(By.css('.fb-form-item-error')), TIMEOUT);
    const errorMessage = await driver.findElement(By.css('.fb-form-item-error'));
    expect(await errorMessage.isDisplayed()).toBe(true);
  });
});

// è¾…åŠ©å‡½æ•°
async function loginToSystem(driver) {
  await driver.get(`${FRONTEND_URL}/#/login`);
  
  // ç­‰å¾…ç™»å½•é¡µé¢åŠ è½½
  await driver.wait(until.elementLocated(By.css('input[type="text"]')), TIMEOUT);
  
  // è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
  const usernameInput = await driver.findElement(By.css('input[type="text"]'));
  await usernameInput.sendKeys('admin');
  
  const passwordInput = await driver.findElement(By.css('input[type="password"]'));
  await passwordInput.sendKeys('admin123');
  
  // ç‚¹å‡»ç™»å½•æŒ‰é’®
  const loginButton = await driver.findElement(By.css('button[type="submit"]'));
  await loginButton.click();
  
  // ç­‰å¾…ç™»å½•æˆåŠŸ
  await driver.wait(until.urlContains('dashboard'), TIMEOUT);
}
```

#### 4.2.3 æ€§èƒ½æµ‹è¯•è„šæœ¬
```javascript
// æœºæ„ç®¡ç†æ€§èƒ½æµ‹è¯•é…ç½®
module.exports = {
  config: {
    target: 'http://localhost:8082',
    phases: [
      {
        duration: '2m',
        arrivalRate: 10,
        name: 'é¢„çƒ­é˜¶æ®µ'
      },
      {
        duration: '5m',
        arrivalRate: 50,
        name: 'è´Ÿè½½æµ‹è¯•'
      },
      {
        duration: '2m',
        arrivalRate: 100,
        name: 'å‹åŠ›æµ‹è¯•'
      }
    ],
    defaults: {
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer {{ authToken }}'
      }
    }
  },
  scenarios: [
    {
      name: 'æœºæ„æ ‘æŸ¥è¯¢æ€§èƒ½æµ‹è¯•',
      weight: 40,
      flow: [
        {
          get: {
            url: '/ps-be/sys/dept/org/tree',
            qs: {
              deptId: '',
              jwtdid: 'test_dept_id',
              sync: 1
            },
            capture: {
              json: '$.data',
              as: 'treeData'
            },
            expect: [
              {
                statusCode: 200
              },
              {
                hasProperty: 'data'
              }
            ]
          }
        }
      ]
    },
    {
      name: 'æœºæ„æ–°å¢æ€§èƒ½æµ‹è¯•',
      weight: 30,
      flow: [
        {
          post: {
            url: '/ps-be/sys/dept/org/add',
            qs: {
              jwtpid: 'test_user_id'
            },
            json: {
              deptFullName: 'æ€§èƒ½æµ‹è¯•æœºæ„{{ $randomString() }}',
              deptSimpleName: 'æ€§èƒ½æµ‹è¯•{{ $randomString() }}',
              deptNo: 'PERF_{{ $randomString() }}',
              deptType: '01',
              principalName: 'æµ‹è¯•è´Ÿè´£äºº',
              principalTel: '13800138000',
              orderIndex: 1,
              cityCode: '110000',
              enabled: 1,
              deptDesc: 'æ€§èƒ½æµ‹è¯•åˆ›å»ºçš„æœºæ„'
            },
            expect: [
              {
                statusCode: 200
              }
            ]
          }
        }
      ]
    },
    {
      name: 'æœºæ„æŸ¥è¯¢æ€§èƒ½æµ‹è¯•',
      weight: 30,
      flow: [
        {
          get: {
            url: '/ps-be/sys/dept/view',
            qs: {
              deptId: 'test_dept_id',
              jwtpid: 'test_user_id',
              jwtaid: 'test_admin_id'
            },
            expect: [
              {
                statusCode: 200
              }
            ]
          }
        }
      ]
    }
  ]
};
```

## 5. æµ‹è¯•æ•°æ®å‡†å¤‡

### 5.1 åŸºç¡€æµ‹è¯•æ•°æ®
```sql
-- æ¸…ç†æµ‹è¯•æ•°æ®
DELETE FROM tp_dept_basicinfo WHERE dept_no LIKE 'TEST%' OR dept_no LIKE 'AUTO%';

-- æ’å…¥æµ‹è¯•ç”¨çš„æœºæ„ç±»å‹å­—å…¸æ•°æ®
INSERT INTO tp_dict_detail (dict_code, dict_name, dict_value, dict_desc, enabled) VALUES
('SYS05', 'æ”¿åºœæœºå…³', '01', 'æ”¿åºœæœºå…³ç±»å‹', 1),
('SYS05', 'ä¼ä¸šå•ä½', '02', 'ä¼ä¸šå•ä½ç±»å‹', 1),
('SYS05', 'äº‹ä¸šå•ä½', '03', 'äº‹ä¸šå•ä½ç±»å‹', 1);

-- æ’å…¥æµ‹è¯•ç”¨çš„è¡Œæ”¿åŒºåˆ’æ•°æ®
INSERT INTO tp_city (city_code, city_name, parent_code, city_level) VALUES
('110000', 'åŒ—äº¬å¸‚', '100000', 1),
('110100', 'åŒ—äº¬å¸‚å¸‚è¾–åŒº', '110000', 2),
('110101', 'ä¸œåŸåŒº', '110100', 3);

-- åˆ›å»ºæµ‹è¯•ç”¨çš„æ ¹æœºæ„
INSERT INTO tp_dept_basicinfo (
  id, dept_full_name, dept_simple_name, dept_no, dept_type, 
  principal_name, principal_tel, order_index, city_code, 
  enabled, dept_desc, create_time, creator
) VALUES (
  'test_root_dept', 'æµ‹è¯•æ ¹æœºæ„', 'æµ‹è¯•æ ¹æœºæ„', 'ROOT_TEST', '01',
  'æµ‹è¯•ç®¡ç†å‘˜', '13800138000', 1, '110000',
  1, 'ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ ¹æœºæ„', NOW(), 'test_user'
);
```

### 5.2 è¾¹ç•Œæµ‹è¯•æ•°æ®
```javascript
// è¾¹ç•Œæµ‹è¯•æ•°æ®é›†
const boundaryTestData = {
  // å­—æ®µé•¿åº¦è¾¹ç•Œæµ‹è¯•
  maxLengthData: {
    deptFullName: 'A'.repeat(100), // æœ€å¤§é•¿åº¦
    deptSimpleName: 'B'.repeat(50), // æœ€å¤§é•¿åº¦
    principalName: 'C'.repeat(20), // æœ€å¤§é•¿åº¦
    deptDesc: 'D'.repeat(200) // æœ€å¤§é•¿åº¦
  },
  
  // è¶…å‡ºé•¿åº¦é™åˆ¶çš„æ•°æ®
  overLengthData: {
    deptFullName: 'A'.repeat(101), // è¶…å‡ºé™åˆ¶
    deptSimpleName: 'B'.repeat(51), // è¶…å‡ºé™åˆ¶
    principalName: 'C'.repeat(21), // è¶…å‡ºé™åˆ¶
    deptDesc: 'D'.repeat(201) // è¶…å‡ºé™åˆ¶
  },
  
  // ç‰¹æ®Šå­—ç¬¦æµ‹è¯•æ•°æ®
  specialCharData: {
    deptFullName: '<script>alert("XSS")</script>',
    deptSimpleName: '"; DROP TABLE tp_dept_basicinfo; --',
    principalName: '\x00\x01\x02',
    deptDesc: 'ğŸš€ğŸ‰ğŸ’»ğŸ“±ğŸŒŸ' // emojiå­—ç¬¦
  },
  
  // ç”µè¯å·ç æµ‹è¯•æ•°æ®
  phoneTestData: [
    '13800138000', // æœ‰æ•ˆæ‰‹æœºå·
    '010-12345678', // æœ‰æ•ˆå›ºè¯
    '400-123-4567', // æœ‰æ•ˆ400å·ç 
    '12345', // æ— æ•ˆå·ç 
    'abc123def', // åŒ…å«å­—æ¯
    '138001380001' // è¶…é•¿å·ç 
  ]
};
```

### 5.3 æ€§èƒ½æµ‹è¯•æ•°æ®
```javascript
// æ€§èƒ½æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
class PerformanceTestDataGenerator {
  static generateOrgData(count) {
    const orgData = [];
    for (let i = 1; i <= count; i++) {
      orgData.push({
        deptFullName: `æ€§èƒ½æµ‹è¯•æœºæ„${i.toString().padStart(4, '0')}`,
        deptSimpleName: `æµ‹è¯•æœºæ„${i}`,
        deptNo: `PERF_${i.toString().padStart(4, '0')}`,
        deptType: i % 2 === 0 ? '01' : '02',
        principalName: `è´Ÿè´£äºº${i}`,
        principalTel: `138${(i % 10000).toString().padStart(8, '0')}`,
        orderIndex: i,
        cityCode: '110000',
        enabled: 1,
        deptDesc: `è¿™æ˜¯ç¬¬${i}ä¸ªæ€§èƒ½æµ‹è¯•æœºæ„`
      });
    }
    return orgData;
  }
  
  static generateTreeStructure(depth, breadth) {
    // ç”ŸæˆæŒ‡å®šæ·±åº¦å’Œå¹¿åº¦çš„æœºæ„æ ‘ç»“æ„
    const treeData = [];
    
    function createNode(level, parentId, index) {
      const nodeId = `node_${level}_${index}`;
      const node = {
        id: nodeId,
        deptFullName: `ç¬¬${level}çº§æœºæ„${index}`,
        deptSimpleName: `æœºæ„${level}-${index}`,
        deptNo: `TREE_${level}_${index}`,
        parentId: parentId,
        children: []
      };
      
      if (level < depth) {
        for (let i = 1; i <= breadth; i++) {
          node.children.push(createNode(level + 1, nodeId, i));
        }
      }
      
      return node;
    }
    
    for (let i = 1; i <= breadth; i++) {
      treeData.push(createNode(1, null, i));
    }
    
    return treeData;
  }
}
```

## 6. æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### 6.1 æµ‹è¯•é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | æ—¶é—´å®‰æ’ | æµ‹è¯•å†…å®¹ | è´Ÿè´£äºº | äº¤ä»˜ç‰© |
|------|----------|----------|--------|--------|
| ç¬¬ä¸€é˜¶æ®µ | ç¬¬1-2å¤© | ç¯å¢ƒæ­å»ºã€åŸºç¡€åŠŸèƒ½æµ‹è¯• | æµ‹è¯•å·¥ç¨‹å¸ˆA | ç¯å¢ƒé…ç½®æ–‡æ¡£ã€åŸºç¡€åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š |
| ç¬¬äºŒé˜¶æ®µ | ç¬¬3-4å¤© | å­—æ®µéªŒè¯ã€è¾¹ç•Œæµ‹è¯• | æµ‹è¯•å·¥ç¨‹å¸ˆB | å­—æ®µéªŒè¯æµ‹è¯•æŠ¥å‘Š |
| ç¬¬ä¸‰é˜¶æ®µ | ç¬¬5-6å¤© | æ•°æ®å…³è”ã€ä¸šåŠ¡æµç¨‹æµ‹è¯• | æµ‹è¯•å·¥ç¨‹å¸ˆA | ä¸šåŠ¡æµç¨‹æµ‹è¯•æŠ¥å‘Š |
| ç¬¬å››é˜¶æ®µ | ç¬¬7-8å¤© | æ€§èƒ½æµ‹è¯•ã€å®‰å…¨æµ‹è¯• | æµ‹è¯•å·¥ç¨‹å¸ˆC | æ€§èƒ½æµ‹è¯•æŠ¥å‘Šã€å®‰å…¨æµ‹è¯•æŠ¥å‘Š |
| ç¬¬äº”é˜¶æ®µ | ç¬¬9-10å¤© | è‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡Œã€å›å½’æµ‹è¯• | å…¨ä½“æµ‹è¯•äººå‘˜ | è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šã€å›å½’æµ‹è¯•æŠ¥å‘Š |

### 6.2 æµ‹è¯•ç¯å¢ƒè¦æ±‚

#### 6.2.1 ç¡¬ä»¶ç¯å¢ƒ
- **æµ‹è¯•æœåŠ¡å™¨**ï¼š4C 8G é…ç½®
- **æ•°æ®åº“æœåŠ¡å™¨**ï¼šç‹¬ç«‹æ•°æ®åº“å®ä¾‹
- **å®¢æˆ·ç«¯**ï¼šChromeæµè§ˆå™¨æœ€æ–°ç‰ˆæœ¬

#### 6.2.2 è½¯ä»¶ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 20.04 LTS
- **Javaç‰ˆæœ¬**ï¼šJDK 11+
- **Node.jsç‰ˆæœ¬**ï¼š16.x+
- **æ•°æ®åº“**ï¼šMariaDB 10.5+
- **æµ‹è¯•å·¥å…·**ï¼š
  - Jest 29.x
  - Selenium WebDriver 4.x
  - Artillery.js 2.x
  - Postman/Newman

### 6.3 æµ‹è¯•æ•°æ®ç®¡ç†

#### 6.3.1 æ•°æ®å‡†å¤‡ç­–ç•¥
1. **åŸºç¡€æ•°æ®**ï¼šåœ¨æµ‹è¯•å¼€å§‹å‰å‡†å¤‡å¥½å­—å…¸æ•°æ®ã€åŒºåˆ’æ•°æ®ç­‰
2. **æµ‹è¯•æ•°æ®**ï¼šæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®
3. **æ•°æ®éš”ç¦»**ï¼šä½¿ç”¨ç‰¹å®šå‰ç¼€æ ‡è¯†æµ‹è¯•æ•°æ®ï¼Œé¿å…å½±å“ç”Ÿäº§æ•°æ®

#### 6.3.2 æ•°æ®æ¸…ç†ç­–ç•¥
1. **è‡ªåŠ¨æ¸…ç†**ï¼šæµ‹è¯•å®Œæˆåè‡ªåŠ¨åˆ é™¤æµ‹è¯•æ•°æ®
2. **æ‰‹åŠ¨æ¸…ç†**ï¼šå®šæœŸæ‰‹åŠ¨æ¸…ç†æ®‹ç•™çš„æµ‹è¯•æ•°æ®
3. **æ•°æ®å¤‡ä»½**ï¼šæµ‹è¯•å‰å¤‡ä»½é‡è¦æ•°æ®

## 7. ç¼ºé™·ç®¡ç†

### 7.1 ç¼ºé™·åˆ†ç±»

| ä¸¥é‡çº§åˆ« | æè¿° | å¤„ç†æ—¶é—´ | ç¤ºä¾‹ |
|----------|------|----------|------|
| è‡´å‘½ | ç³»ç»Ÿå´©æºƒã€æ•°æ®ä¸¢å¤± | 2å°æ—¶å†… | æœºæ„åˆ é™¤å¯¼è‡´ç³»ç»Ÿå´©æºƒ |
| ä¸¥é‡ | æ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨ | 1å¤©å†… | æœºæ„æ–°å¢åŠŸèƒ½å®Œå…¨å¤±æ•ˆ |
| ä¸€èˆ¬ | åŠŸèƒ½å¼‚å¸¸ä½†æœ‰æ›¿ä»£æ–¹æ¡ˆ | 3å¤©å†… | æœºæ„æ ‘å±•å¼€ç¼“æ…¢ |
| è½»å¾® | ç•Œé¢æ˜¾ç¤ºé—®é¢˜ | 1å‘¨å†… | æŒ‰é’®æ ·å¼ä¸ç»Ÿä¸€ |

### 7.2 ç¼ºé™·è·Ÿè¸ªæµç¨‹
1. **å‘ç°ç¼ºé™·** â†’ è®°å½•ç¼ºé™·è¯¦æƒ…
2. **åˆ†æç¼ºé™·** â†’ ç¡®å®šä¸¥é‡çº§åˆ«å’Œå½±å“èŒƒå›´
3. **åˆ†é…ç¼ºé™·** â†’ æŒ‡æ´¾ç»™ç›¸åº”å¼€å‘äººå‘˜
4. **ä¿®å¤ç¼ºé™·** â†’ å¼€å‘äººå‘˜ä¿®å¤å¹¶æäº¤
5. **éªŒè¯ç¼ºé™·** â†’ æµ‹è¯•äººå‘˜éªŒè¯ä¿®å¤æ•ˆæœ
6. **å…³é—­ç¼ºé™·** â†’ ç¡®è®¤ä¿®å¤åå…³é—­ç¼ºé™·

### 7.3 ç¼ºé™·æŠ¥å‘Šæ¨¡æ¿
```markdown
## ç¼ºé™·IDï¼šBUG-ORG-001

**ç¼ºé™·æ ‡é¢˜**ï¼šæœºæ„å…¨ç§°è¶…é•¿æ—¶ä¿å­˜å¤±è´¥ä½†æ— é”™è¯¯æç¤º

**å‘ç°æ—¶é—´**ï¼š2024-01-15 14:30:00

**å‘ç°äººå‘˜**ï¼šæµ‹è¯•å·¥ç¨‹å¸ˆA

**ä¸¥é‡çº§åˆ«**ï¼šä¸€èˆ¬

**ç¼ºé™·æè¿°**ï¼š
å½“æœºæ„å…¨ç§°è¾“å…¥è¶…è¿‡100ä¸ªå­—ç¬¦æ—¶ï¼Œç‚¹å‡»ä¿å­˜æŒ‰é’®åä¿å­˜å¤±è´¥ï¼Œä½†é¡µé¢æ²¡æœ‰æ˜¾ç¤ºä»»ä½•é”™è¯¯æç¤ºä¿¡æ¯ã€‚

**é‡ç°æ­¥éª¤**ï¼š
1. æ‰“å¼€æœºæ„æ–°å¢é¡µé¢
2. åœ¨æœºæ„å…¨ç§°å­—æ®µè¾“å…¥101ä¸ªå­—ç¬¦
3. å¡«å†™å…¶ä»–å¿…å¡«å­—æ®µ
4. ç‚¹å‡»ä¿å­˜æŒ‰é’®

**é¢„æœŸç»“æœ**ï¼š
æ˜¾ç¤ºå­—æ®µé•¿åº¦è¶…å‡ºé™åˆ¶çš„é”™è¯¯æç¤º

**å®é™…ç»“æœ**ï¼š
ä¿å­˜å¤±è´¥ä½†æ— ä»»ä½•æç¤º

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- æµè§ˆå™¨ï¼šChrome 120.0.6099.109
- æ“ä½œç³»ç»Ÿï¼šWindows 11
- åç«¯ç‰ˆæœ¬ï¼šv1.0.0

**é™„ä»¶**ï¼š
- æˆªå›¾ï¼šbug-org-001-screenshot.png
- æ—¥å¿—ï¼šbug-org-001-log.txt
```

## 8. æµ‹è¯•æŠ¥å‘Š

### 8.1 æµ‹è¯•æ‰§è¡Œæ€»ç»“

#### 8.1.1 æµ‹è¯•æ¦‚å†µ
- **æµ‹è¯•å¼€å§‹æ—¶é—´**ï¼š[å¾…å¡«å†™]
- **æµ‹è¯•ç»“æŸæ—¶é—´**ï¼š[å¾…å¡«å†™]
- **æµ‹è¯•ç”¨ä¾‹æ€»æ•°**ï¼š20ä¸ª
- **æ‰§è¡Œç”¨ä¾‹æ•°**ï¼š[å¾…å¡«å†™]
- **é€šè¿‡ç”¨ä¾‹æ•°**ï¼š[å¾…å¡«å†™]
- **å¤±è´¥ç”¨ä¾‹æ•°**ï¼š[å¾…å¡«å†™]
- **é€šè¿‡ç‡**ï¼š[å¾…å¡«å†™]%

#### 8.1.2 åŠŸèƒ½æµ‹è¯•ç»“æœ

| åŠŸèƒ½æ¨¡å— | ç”¨ä¾‹æ•° | é€šè¿‡æ•° | å¤±è´¥æ•° | é€šè¿‡ç‡ | å¤‡æ³¨ |
|----------|--------|--------|--------|--------|------|
| æœºæ„æ–°å¢ | 4 | [å¾…å¡«å†™] | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | |
| æœºæ„æŸ¥è¯¢ | 3 | [å¾…å¡«å†™] | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | |
| æœºæ„ç¼–è¾‘ | 3 | [å¾…å¡«å†™] | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | |
| æœºæ„åˆ é™¤ | 2 | [å¾…å¡«å†™] | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | |
| å­—æ®µéªŒè¯ | 4 | [å¾…å¡«å†™] | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | |
| æ•°æ®å…³è” | 2 | [å¾…å¡«å†™] | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | |
| æ€§èƒ½æµ‹è¯• | 2 | [å¾…å¡«å†™] | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | |

#### 8.1.3 æ€§èƒ½æµ‹è¯•ç»“æœ

| æµ‹è¯•åœºæ™¯ | ç›®æ ‡æŒ‡æ ‡ | å®é™…ç»“æœ | æ˜¯å¦è¾¾æ ‡ | å¤‡æ³¨ |
|----------|----------|----------|----------|------|
| æœºæ„æ ‘åŠ è½½ | < 3ç§’ | [å¾…å¡«å†™] | [å¾…å¡«å†™] | |
| èŠ‚ç‚¹å±•å¼€ | < 1ç§’ | [å¾…å¡«å†™] | [å¾…å¡«å†™] | |
| æœºæ„æ–°å¢ | < 500ms | [å¾…å¡«å†™] | [å¾…å¡«å†™] | |
| æ‰¹é‡æ“ä½œ | < 500ms/ä¸ª | [å¾…å¡«å†™] | [å¾…å¡«å†™] | |

### 8.2 ç¼ºé™·ç»Ÿè®¡

#### 8.2.1 ç¼ºé™·åˆ†å¸ƒ

| ä¸¥é‡çº§åˆ« | æ•°é‡ | å æ¯” | çŠ¶æ€åˆ†å¸ƒ |
|----------|------|------|----------|
| è‡´å‘½ | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | å·²ä¿®å¤ï¼š[å¾…å¡«å†™]ï¼Œå¾…ä¿®å¤ï¼š[å¾…å¡«å†™] |
| ä¸¥é‡ | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | å·²ä¿®å¤ï¼š[å¾…å¡«å†™]ï¼Œå¾…ä¿®å¤ï¼š[å¾…å¡«å†™] |
| ä¸€èˆ¬ | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | å·²ä¿®å¤ï¼š[å¾…å¡«å†™]ï¼Œå¾…ä¿®å¤ï¼š[å¾…å¡«å†™] |
| è½»å¾® | [å¾…å¡«å†™] | [å¾…å¡«å†™]% | å·²ä¿®å¤ï¼š[å¾…å¡«å†™]ï¼Œå¾…ä¿®å¤ï¼š[å¾…å¡«å†™] |

#### 8.2.2 ç¼ºé™·è¶‹åŠ¿åˆ†æ
[å¾…å¡«å†™ç¼ºé™·å‘ç°å’Œä¿®å¤çš„è¶‹åŠ¿å›¾è¡¨]

### 8.3 æµ‹è¯•ç»“è®º

#### 8.3.1 åŠŸèƒ½å®Œæ•´æ€§
[å¾…å¡«å†™åŠŸèƒ½å®Œæ•´æ€§è¯„ä¼°ç»“æœ]

#### 8.3.2 è´¨é‡è¯„ä¼°
[å¾…å¡«å†™ç³»ç»Ÿè´¨é‡è¯„ä¼°ç»“æœ]

#### 8.3.3 é£é™©è¯„ä¼°
[å¾…å¡«å†™å‘ç°çš„é£é™©ç‚¹å’Œå»ºè®®]

#### 8.3.4 ä¸Šçº¿å»ºè®®
[å¾…å¡«å†™æ˜¯å¦å»ºè®®ä¸Šçº¿åŠæ³¨æ„äº‹é¡¹]

## 9. é£é™©è¯„ä¼°

### 9.1 æŠ€æœ¯é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | å½±å“æè¿° | åº”å¯¹æªæ–½ |
|--------|----------|----------|----------|
| æ•°æ®åº“è¿æ¥å¼‚å¸¸ | é«˜ | å¯èƒ½å¯¼è‡´æœºæ„æ•°æ®æ— æ³•ä¿å­˜æˆ–æŸ¥è¯¢ | 1. å¢åŠ æ•°æ®åº“è¿æ¥é‡è¯•æœºåˆ¶<br>2. å®ç°æ•°æ®åº“è¿æ¥æ± ç›‘æ§<br>3. å‡†å¤‡æ•°æ®åº“æ•…éšœåˆ‡æ¢æ–¹æ¡ˆ |
| å¤§æ•°æ®é‡æ€§èƒ½é—®é¢˜ | ä¸­ | æœºæ„æ ‘åŠ è½½ç¼“æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ | 1. å®ç°åˆ†é¡µåŠ è½½<br>2. æ·»åŠ æ•°æ®ç¼“å­˜æœºåˆ¶<br>3. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢è¯­å¥ |
| å¹¶å‘æ“ä½œå†²çª | ä¸­ | å¤šç”¨æˆ·åŒæ—¶æ“ä½œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ | 1. å®ç°ä¹è§‚é”æœºåˆ¶<br>2. æ·»åŠ æ“ä½œæ—¥å¿—è®°å½•<br>3. å¢åŠ æ•°æ®ç‰ˆæœ¬æ§åˆ¶ |

### 9.2 ä¸šåŠ¡é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | å½±å“æè¿° | åº”å¯¹æªæ–½ |
|--------|----------|----------|----------|
| æœºæ„å±‚çº§å…³ç³»é”™è¯¯ | é«˜ | å¯èƒ½å¯¼è‡´æƒé™åˆ†é…é”™è¯¯ï¼Œå½±å“ç³»ç»Ÿå®‰å…¨ | 1. å¢å¼ºå±‚çº§å…³ç³»éªŒè¯<br>2. å®ç°å…³ç³»å˜æ›´å®¡æ‰¹æµç¨‹<br>3. æ·»åŠ å…³ç³»å˜æ›´æ—¥å¿— |
| æ•°æ®è¿ç§»é£é™© | ä¸­ | å†å²æ•°æ®è¿ç§»å¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±æˆ–é”™è¯¯ | 1. åˆ¶å®šè¯¦ç»†çš„æ•°æ®è¿ç§»æ–¹æ¡ˆ<br>2. è¿›è¡Œå……åˆ†çš„è¿ç§»æµ‹è¯•<br>3. å‡†å¤‡æ•°æ®å›æ»šæ–¹æ¡ˆ |
| ç”¨æˆ·æƒé™ç®¡ç† | ä¸­ | æƒé™é…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´è¶Šæƒæ“ä½œ | 1. å®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶<br>2. å®šæœŸè¿›è¡Œæƒé™å®¡è®¡<br>3. æ·»åŠ æ•æ„Ÿæ“ä½œå®¡æ‰¹ |

### 9.3 å®‰å…¨é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | å½±å“æè¿° | åº”å¯¹æªæ–½ |
|--------|----------|----------|----------|
| SQLæ³¨å…¥æ”»å‡» | é«˜ | å¯èƒ½å¯¼è‡´æ•°æ®åº“è¢«æ¶æ„æ“ä½œ | 1. ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢<br>2. è¾“å…¥æ•°æ®éªŒè¯å’Œè¿‡æ»¤<br>3. å®šæœŸè¿›è¡Œå®‰å…¨æ‰«æ |
| XSSæ”»å‡» | ä¸­ | å¯èƒ½å¯¼è‡´ç”¨æˆ·ä¿¡æ¯æ³„éœ² | 1. è¾“å‡ºæ•°æ®è½¬ä¹‰<br>2. å®ç°CSPç­–ç•¥<br>3. å®šæœŸæ›´æ–°å‰ç«¯å®‰å…¨åº“ |
| æ•æ„Ÿä¿¡æ¯æ³„éœ² | ä¸­ | æœºæ„ä¿¡æ¯å¯èƒ½è¢«æœªæˆæƒè®¿é—® | 1. å®ç°æ•°æ®åŠ å¯†ä¼ è¾“<br>2. æ•æ„Ÿå­—æ®µè„±æ•æ˜¾ç¤º<br>3. è®¿é—®æ—¥å¿—è®°å½•å’Œç›‘æ§ |

## 10. é™„å½•

### 10.1 æµ‹è¯•ç¯å¢ƒé…ç½®

#### 10.1.1 Jesté…ç½®æ–‡ä»¶
```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'node',
  roots: ['<rootDir>/tests'],
  testMatch: [
    '**/__tests__/**/*.+(ts|tsx|js)',
    '**/*.(test|spec).+(ts|tsx|js)'
  ],
  transform: {
    '^.+\.(ts|tsx)$': 'ts-jest'
  },
  collectCoverageFrom: [
    'src/**/*.{js,ts}',
    '!src/**/*.d.ts'
  ],
  coverageDirectory: 'coverage',
  coverageReporters: [
    'text',
    'lcov',
    'html'
  ],
  setupFilesAfterEnv: ['<rootDir>/tests/setup.js'],
  testTimeout: 30000
};
```

#### 10.1.2 Seleniumé…ç½®
```javascript
// selenium.config.js
const { Builder } = require('selenium-webdriver');
const chrome = require('selenium-webdriver/chrome');

class WebDriverManager {
  static async createDriver() {
    const options = new chrome.Options();
    
    // æ— å¤´æ¨¡å¼é…ç½®ï¼ˆCIç¯å¢ƒä½¿ç”¨ï¼‰
    if (process.env.HEADLESS === 'true') {
      options.addArguments('--headless');
    }
    
    // å…¶ä»–Chromeé€‰é¡¹
    options.addArguments('--no-sandbox');
    options.addArguments('--disable-dev-shm-usage');
    options.addArguments('--disable-gpu');
    options.addArguments('--window-size=1920,1080');
    
    const driver = await new Builder()
      .forBrowser('chrome')
      .setChromeOptions(options)
      .build();
    
    // è®¾ç½®éšå¼ç­‰å¾…
    await driver.manage().setTimeouts({
      implicit: 10000,
      pageLoad: 30000,
      script: 30000
    });
    
    return driver;
  }
}

module.exports = WebDriverManager;
```

### 10.2 æ•°æ®åº“è„šæœ¬

#### 10.2.1 æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬
```sql
-- æœºæ„ç®¡ç†æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬
-- æ‰§è¡Œå‰è¯·å¤‡ä»½æ•°æ®åº“

-- 1. æ¸…ç†å†å²æµ‹è¯•æ•°æ®
DELETE FROM tp_dept_basicinfo WHERE dept_no LIKE 'TEST_%' OR dept_no LIKE 'AUTO_%' OR dept_no LIKE 'PERF_%';
DELETE FROM tp_person_dept WHERE dept_id IN (
    SELECT id FROM tp_dept_basicinfo WHERE dept_no LIKE 'TEST_%'
);

-- 2. æ’å…¥æµ‹è¯•ç”¨å­—å…¸æ•°æ®
INSERT IGNORE INTO tp_dict_detail (dict_code, dict_name, dict_value, dict_desc, enabled, create_time) VALUES
('SYS05', 'æ”¿åºœæœºå…³', '01', 'æ”¿åºœæœºå…³ç±»å‹', 1, NOW()),
('SYS05', 'ä¼ä¸šå•ä½', '02', 'ä¼ä¸šå•ä½ç±»å‹', 1, NOW()),
('SYS05', 'äº‹ä¸šå•ä½', '03', 'äº‹ä¸šå•ä½ç±»å‹', 1, NOW()),
('SYS05', 'ç¤¾ä¼šå›¢ä½“', '04', 'ç¤¾ä¼šå›¢ä½“ç±»å‹', 1, NOW());

-- 3. æ’å…¥æµ‹è¯•ç”¨è¡Œæ”¿åŒºåˆ’æ•°æ®
INSERT IGNORE INTO tp_city (city_code, city_name, parent_code, city_level, enabled, create_time) VALUES
('100000', 'ä¸­åäººæ°‘å…±å’Œå›½', '', 0, 1, NOW()),
('110000', 'åŒ—äº¬å¸‚', '100000', 1, 1, NOW()),
('110100', 'åŒ—äº¬å¸‚å¸‚è¾–åŒº', '110000', 2, 1, NOW()),
('110101', 'ä¸œåŸåŒº', '110100', 3, 1, NOW()),
('110102', 'è¥¿åŸåŒº', '110100', 3, 1, NOW()),
('120000', 'å¤©æ´¥å¸‚', '100000', 1, 1, NOW()),
('120100', 'å¤©æ´¥å¸‚å¸‚è¾–åŒº', '120000', 2, 1, NOW());

-- 4. åˆ›å»ºæµ‹è¯•ç”¨æ ¹æœºæ„
INSERT INTO tp_dept_basicinfo (
    id, dept_full_name, dept_simple_name, dept_no, dept_type,
    principal_name, principal_tel, order_index, city_code,
    enabled, dept_desc, create_time, creator, parent_id
) VALUES (
    'test_root_org', 'è‡ªåŠ¨åŒ–æµ‹è¯•æ ¹æœºæ„', 'æµ‹è¯•æ ¹æœºæ„', 'TEST_ROOT_001', '01',
    'æµ‹è¯•ç®¡ç†å‘˜', '13800138000', 1, '110000',
    1, 'ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ ¹æœºæ„ï¼Œè¯·å‹¿åˆ é™¤', NOW(), 'auto_test', NULL
);

-- 5. åˆ›å»ºæµ‹è¯•ç”¨å­æœºæ„
INSERT INTO tp_dept_basicinfo (
    id, dept_full_name, dept_simple_name, dept_no, dept_type,
    principal_name, principal_tel, order_index, city_code,
    enabled, dept_desc, create_time, creator, parent_id
) VALUES 
(
    'test_child_org_1', 'è‡ªåŠ¨åŒ–æµ‹è¯•å­æœºæ„1', 'æµ‹è¯•å­æœºæ„1', 'TEST_CHILD_001', '02',
    'æµ‹è¯•è´Ÿè´£äºº1', '13800138001', 1, '110101',
    1, 'ç”¨äºæµ‹è¯•å±‚çº§å…³ç³»çš„å­æœºæ„1', NOW(), 'auto_test', 'test_root_org'
),
(
    'test_child_org_2', 'è‡ªåŠ¨åŒ–æµ‹è¯•å­æœºæ„2', 'æµ‹è¯•å­æœºæ„2', 'TEST_CHILD_002', '03',
    'æµ‹è¯•è´Ÿè´£äºº2', '13800138002', 2, '110102',
    1, 'ç”¨äºæµ‹è¯•å±‚çº§å…³ç³»çš„å­æœºæ„2', NOW(), 'auto_test', 'test_root_org'
);

-- 6. åˆ›å»ºæµ‹è¯•ç”¨æˆ·ï¼ˆå¦‚æœéœ€è¦ï¼‰
INSERT IGNORE INTO tp_person_basicinfo (
    id, person_name, login_name, password, enabled, create_time
) VALUES (
    'test_user_001', 'è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨æˆ·', 'autotest', 'e10adc3949ba59abbe56e057f20f883e', 1, NOW()
);

-- 7. å»ºç«‹æµ‹è¯•ç”¨æˆ·ä¸æœºæ„çš„å…³è”
INSERT IGNORE INTO tp_person_dept (
    person_id, dept_id, is_main, create_time
) VALUES (
    'test_user_001', 'test_root_org', 1, NOW()
);

COMMIT;
```

#### 10.2.2 æµ‹è¯•æ•°æ®æ¸…ç†è„šæœ¬
```sql
-- æœºæ„ç®¡ç†æµ‹è¯•æ•°æ®æ¸…ç†è„šæœ¬
-- æ¸…ç†æ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•äº§ç”Ÿçš„æ•°æ®

START TRANSACTION;

-- 1. æ¸…ç†äººå‘˜æœºæ„å…³è”
DELETE FROM tp_person_dept WHERE dept_id IN (
    SELECT id FROM tp_dept_basicinfo WHERE dept_no LIKE 'TEST_%' OR dept_no LIKE 'AUTO_%' OR dept_no LIKE 'PERF_%'
);

-- 2. æ¸…ç†æœºæ„æ‰©å±•ä¿¡æ¯
DELETE FROM tp_dept_exinfo WHERE dept_id IN (
    SELECT id FROM tp_dept_basicinfo WHERE dept_no LIKE 'TEST_%' OR dept_no LIKE 'AUTO_%' OR dept_no LIKE 'PERF_%'
);

-- 3. æ¸…ç†æœºæ„åŸºæœ¬ä¿¡æ¯
DELETE FROM tp_dept_basicinfo WHERE 
    dept_no LIKE 'TEST_%' OR 
    dept_no LIKE 'AUTO_%' OR 
    dept_no LIKE 'PERF_%' OR
    dept_full_name LIKE '%è‡ªåŠ¨åŒ–æµ‹è¯•%' OR
    dept_full_name LIKE '%æ€§èƒ½æµ‹è¯•%' OR
    creator = 'auto_test';

-- 4. æ¸…ç†æµ‹è¯•ç”¨æˆ·
DELETE FROM tp_person_basicinfo WHERE login_name LIKE 'autotest%' OR person_name LIKE '%è‡ªåŠ¨åŒ–æµ‹è¯•%';

-- 5. é‡ç½®è‡ªå¢IDï¼ˆå¦‚æœä½¿ç”¨è‡ªå¢ä¸»é”®ï¼‰
-- ALTER TABLE tp_dept_basicinfo AUTO_INCREMENT = 1;

COMMIT;

-- éªŒè¯æ¸…ç†ç»“æœ
SELECT COUNT(*) as remaining_test_data FROM tp_dept_basicinfo WHERE 
    dept_no LIKE 'TEST_%' OR 
    dept_no LIKE 'AUTO_%' OR 
    dept_no LIKE 'PERF_%';
```

### 10.3 æŒç»­é›†æˆé…ç½®

#### 10.3.1 GitHub Actionsé…ç½®
```yaml
# .github/workflows/org-management-test.yml
name: æœºæ„ç®¡ç†è‡ªåŠ¨åŒ–æµ‹è¯•

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'src/main/java/com/jiuxi/admin/core/controller/pc/TpDeptBasicinfoController.java'
      - 'src/main/java/com/jiuxi/admin/core/service/TpDeptBasicinfoService.java'
      - 'ps-fe/@fb/admin-base/views/sys/dept/**'
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      mysql:
        image: mariadb:10.5
        env:
          MYSQL_ROOT_PASSWORD: testpassword
          MYSQL_DATABASE: ps_bmp_test
        ports:
          - 3306:3306
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s --health-retries=3
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: è®¾ç½®Javaç¯å¢ƒ
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
    
    - name: è®¾ç½®Node.jsç¯å¢ƒ
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        cache: 'npm'
        cache-dependency-path: ps-fe/package-lock.json
    
    - name: å®‰è£…Chromeæµè§ˆå™¨
      uses: browser-actions/setup-chrome@latest
    
    - name: åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“
      run: |
        mysql -h127.0.0.1 -uroot -ptestpassword ps_bmp_test < tests/sql/init_test_data.sql
    
    - name: æ„å»ºåç«¯åº”ç”¨
      run: |
        cd ps-be
        ./mvnw clean compile test-compile
    
    - name: å®‰è£…å‰ç«¯ä¾èµ–
      run: |
        cd ps-fe
        npm ci
    
    - name: å¯åŠ¨åç«¯æœåŠ¡
      run: |
        cd ps-be
        nohup ./mvnw spring-boot:run -Dspring-boot.run.profiles=test &
        sleep 30
    
    - name: å¯åŠ¨å‰ç«¯æœåŠ¡
      run: |
        cd ps-fe
        nohup npm run dev &
        sleep 20
    
    - name: è¿è¡ŒAPIæµ‹è¯•
      run: |
        npm test -- --testPathPattern=api
    
    - name: è¿è¡ŒUIæµ‹è¯•
      run: |
        npm test -- --testPathPattern=ui
      env:
        HEADLESS: true
    
    - name: è¿è¡Œæ€§èƒ½æµ‹è¯•
      run: |
        npx artillery run tests/performance/org-management-performance.yml
    
    - name: ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
      run: |
        npm run test:report
    
    - name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: test-reports
        path: |
          coverage/
          test-results/
          performance-results/
```

#### 10.3.2 Jenkins Pipelineé…ç½®
```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        JAVA_HOME = '/usr/lib/jvm/java-11-openjdk'
        NODE_HOME = '/usr/local/node'
        MYSQL_HOST = 'localhost'
        MYSQL_PORT = '3306'
        TEST_DB = 'ps_bmp_test'
    }
    
    stages {
        stage('ç¯å¢ƒå‡†å¤‡') {
            steps {
                script {
                    // æ¸…ç†å·¥ä½œç©ºé—´
                    cleanWs()
                    
                    // æ£€å‡ºä»£ç 
                    checkout scm
                    
                    // å‡†å¤‡æµ‹è¯•æ•°æ®åº“
                    sh '''
                        mysql -h${MYSQL_HOST} -P${MYSQL_PORT} -uroot -p${MYSQL_ROOT_PASSWORD} \
                        -e "DROP DATABASE IF EXISTS ${TEST_DB}; CREATE DATABASE ${TEST_DB};"
                        
                        mysql -h${MYSQL_HOST} -P${MYSQL_PORT} -uroot -p${MYSQL_ROOT_PASSWORD} \
                        ${TEST_DB} < tests/sql/init_test_data.sql
                    '''
                }
            }
        }
        
        stage('æ„å»ºåº”ç”¨') {
            parallel {
                stage('æ„å»ºåç«¯') {
                    steps {
                        dir('ps-be') {
                            sh './mvnw clean compile test-compile'
                        }
                    }
                }
                
                stage('æ„å»ºå‰ç«¯') {
                    steps {
                        dir('ps-fe') {
                            sh 'npm ci'
                        }
                    }
                }
            }
        }
        
        stage('å¯åŠ¨æœåŠ¡') {
            steps {
                script {
                    // å¯åŠ¨åç«¯æœåŠ¡
                    dir('ps-be') {
                        sh 'nohup ./mvnw spring-boot:run -Dspring-boot.run.profiles=test > backend.log 2>&1 &'
                    }
                    
                    // ç­‰å¾…åç«¯å¯åŠ¨
                    sh 'sleep 30'
                    
                    // å¯åŠ¨å‰ç«¯æœåŠ¡
                    dir('ps-fe') {
                        sh 'nohup npm run dev > frontend.log 2>&1 &'
                    }
                    
                    // ç­‰å¾…å‰ç«¯å¯åŠ¨
                    sh 'sleep 20'
                    
                    // éªŒè¯æœåŠ¡å¯åŠ¨çŠ¶æ€
                    sh '''
                        curl -f http://localhost:8082/ps-be/actuator/health || exit 1
                        curl -f http://localhost:10801 || exit 1
                    '''
                }
            }
        }
        
        stage('æ‰§è¡Œæµ‹è¯•') {
            parallel {
                stage('APIæµ‹è¯•') {
                    steps {
                        sh 'npm test -- --testPathPattern=api --reporter=junit --outputFile=test-results/api-results.xml'
                    }
                    post {
                        always {
                            junit 'test-results/api-results.xml'
                        }
                    }
                }
                
                stage('UIæµ‹è¯•') {
                    steps {
                        sh 'HEADLESS=true npm test -- --testPathPattern=ui --reporter=junit --outputFile=test-results/ui-results.xml'
                    }
                    post {
                        always {
                            junit 'test-results/ui-results.xml'
                        }
                    }
                }
                
                stage('æ€§èƒ½æµ‹è¯•') {
                    steps {
                        sh 'npx artillery run tests/performance/org-management-performance.yml --output performance-results/results.json'
                        sh 'npx artillery report performance-results/results.json --output performance-results/report.html'
                    }
                }
            }
        }
        
        stage('ç”ŸæˆæŠ¥å‘Š') {
            steps {
                script {
                    // ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
                    sh 'npm run test:coverage'
                    
                    // ç”Ÿæˆç»¼åˆæµ‹è¯•æŠ¥å‘Š
                    sh 'npm run test:report'
                }
            }
            post {
                always {
                    // å‘å¸ƒHTMLæŠ¥å‘Š
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: 'coverage',
                        reportFiles: 'index.html',
                        reportName: 'ä»£ç è¦†ç›–ç‡æŠ¥å‘Š'
                    ])
                    
                    publishHTML([
                        allowMissing: false,
                        alwaysLinkToLastBuild: true,
                        keepAll: true,
                        reportDir: 'performance-results',
                        reportFiles: 'report.html',
                        reportName: 'æ€§èƒ½æµ‹è¯•æŠ¥å‘Š'
                    ])
                    
                    // å½’æ¡£æµ‹è¯•ç»“æœ
                    archiveArtifacts artifacts: 'test-results/**, coverage/**, performance-results/**', fingerprint: true
                }
            }
        }
    }
    
    post {
        always {
            script {
                // åœæ­¢æœåŠ¡
                sh 'pkill -f "spring-boot:run" || true'
                sh 'pkill -f "npm run dev" || true'
                
                // æ¸…ç†æµ‹è¯•æ•°æ®
                sh '''
                    mysql -h${MYSQL_HOST} -P${MYSQL_PORT} -uroot -p${MYSQL_ROOT_PASSWORD} \
                    ${TEST_DB} < tests/sql/cleanup_test_data.sql || true
                '''
            }
        }
        
        success {
            emailext (
                subject: "æœºæ„ç®¡ç†è‡ªåŠ¨åŒ–æµ‹è¯• - æˆåŠŸ - ${env.BUILD_NUMBER}",
                body: "æµ‹è¯•æ‰§è¡ŒæˆåŠŸï¼Œè¯¦ç»†æŠ¥å‘Šè¯·æŸ¥çœ‹ï¼š${env.BUILD_URL}",
                to: "${env.CHANGE_AUTHOR_EMAIL}"
            )
        }
        
        failure {
            emailext (
                subject: "æœºæ„ç®¡ç†è‡ªåŠ¨åŒ–æµ‹è¯• - å¤±è´¥ - ${env.BUILD_NUMBER}",
                body: "æµ‹è¯•æ‰§è¡Œå¤±è´¥ï¼Œè¯·åŠæ—¶å¤„ç†ã€‚è¯¦ç»†ä¿¡æ¯ï¼š${env.BUILD_URL}",
                to: "${env.CHANGE_AUTHOR_EMAIL}"
            )
        }
    }
}
```

### 10.4 æµ‹è¯•å·¥å…·å’Œåº“

#### 10.4.1 ä¾èµ–åŒ…é…ç½®
```json
{
  "name": "org-management-automation-test",
  "version": "1.0.0",
  "description": "æœºæ„ç®¡ç†æ¨¡å—è‡ªåŠ¨åŒ–æµ‹è¯•",
  "scripts": {
    "test": "jest",
    "test:api": "jest --testPathPattern=api",
    "test:ui": "jest --testPathPattern=ui",
    "test:performance": "artillery run tests/performance/org-management-performance.yml",
    "test:coverage": "jest --coverage",
    "test:report": "node scripts/generate-report.js",
    "test:watch": "jest --watch",
    "test:debug": "node --inspect-brk node_modules/.bin/jest --runInBand"
  },
  "devDependencies": {
    "@jest/globals": "^29.7.0",
    "jest": "^29.7.0",
    "selenium-webdriver": "^4.15.0",
    "axios": "^1.6.0",
    "artillery": "^2.0.0",
    "mysql2": "^3.6.0",
    "dotenv": "^16.3.0",
    "faker": "^6.6.6",
    "moment": "^2.29.4",
    "lodash": "^4.17.21",
    "csv-parser": "^3.0.0",
    "xlsx": "^0.18.5"
  },
  "jest": {
    "testEnvironment": "node",
    "setupFilesAfterEnv": ["<rootDir>/tests/setup.js"],
    "testTimeout": 30000,
    "collectCoverageFrom": [
      "tests/**/*.js",
      "!tests/setup.js",
      "!tests/utils/**"
    ],
    "coverageDirectory": "coverage",
    "coverageReporters": ["text", "lcov", "html"],
    "testMatch": [
      "**/__tests__/**/*.js",
      "**/tests/**/*.test.js"
    ]
  }
}
```

#### 10.4.2 æµ‹è¯•å·¥å…·ç±»
```javascript
// tests/utils/TestHelper.js
const axios = require('axios');
const mysql = require('mysql2/promise');
const faker = require('faker');

class TestHelper {
  constructor() {
    this.baseURL = process.env.API_BASE_URL || 'http://localhost:8082/ps-be';
    this.frontendURL = process.env.FRONTEND_URL || 'http://localhost:10801';
    this.dbConfig = {
      host: process.env.DB_HOST || 'localhost',
      port: process.env.DB_PORT || 3306,
      user: process.env.DB_USER || 'root',
      password: process.env.DB_PASSWORD || 'testpassword',
      database: process.env.DB_NAME || 'ps_bmp_test'
    };
  }

  // ç”Ÿæˆæµ‹è¯•æ•°æ®
  generateOrgData(overrides = {}) {
    const defaultData = {
      deptFullName: faker.company.companyName() + 'æœºæ„',
      deptSimpleName: faker.company.companySuffix(),
      deptNo: 'TEST_' + faker.datatype.uuid().substring(0, 8).toUpperCase(),
      deptType: faker.random.arrayElement(['01', '02', '03']),
      principalName: faker.name.findName(),
      principalTel: faker.phone.phoneNumber('138########'),
      orderIndex: faker.datatype.number({ min: 1, max: 999 }),
      cityCode: '110000',
      enabled: 1,
      deptDesc: faker.lorem.sentence()
    };
    
    return { ...defaultData, ...overrides };
  }

  // APIè¯·æ±‚å°è£…
  async apiRequest(method, endpoint, data = null, params = {}) {
    try {
      const config = {
        method,
        url: `${this.baseURL}${endpoint}`,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${this.authToken}`
        },
        params
      };
      
      if (data) {
        config.data = data;
      }
      
      const response = await axios(config);
      return response;
    } catch (error) {
      console.error(`APIè¯·æ±‚å¤±è´¥: ${method} ${endpoint}`, error.message);
      throw error;
    }
  }

  // æ•°æ®åº“æ“ä½œ
  async executeQuery(sql, params = []) {
    const connection = await mysql.createConnection(this.dbConfig);
    try {
      const [results] = await connection.execute(sql, params);
      return results;
    } finally {
      await connection.end();
    }
  }

  // æ¸…ç†æµ‹è¯•æ•°æ®
  async cleanupTestData(pattern = 'TEST_%') {
    const sql = `
      DELETE FROM tp_dept_basicinfo 
      WHERE dept_no LIKE ? OR creator = 'auto_test'
    `;
    await this.executeQuery(sql, [pattern]);
  }

  // ç­‰å¾…å…ƒç´ å‡ºç°
  async waitForElement(driver, locator, timeout = 10000) {
    const { until } = require('selenium-webdriver');
    return await driver.wait(until.elementLocated(locator), timeout);
  }

  // æˆªå›¾
  async takeScreenshot(driver, filename) {
    const fs = require('fs');
    const screenshot = await driver.takeScreenshot();
    fs.writeFileSync(`screenshots/${filename}`, screenshot, 'base64');
  }

  // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
  generateTestReport(results) {
    const report = {
      timestamp: new Date().toISOString(),
      summary: {
        total: results.length,
        passed: results.filter(r => r.status === 'passed').length,
        failed: results.filter(r => r.status === 'failed').length,
        skipped: results.filter(r => r.status === 'skipped').length
      },
      details: results
    };
    
    const fs = require('fs');
    fs.writeFileSync(
      'test-results/report.json', 
      JSON.stringify(report, null, 2)
    );
    
    return report;
  }
}

module.exports = TestHelper;
```

## 11. æ€»ç»“

æœ¬è‡ªåŠ¨åŒ–æµ‹è¯•è®¡åˆ’å…¨é¢è¦†ç›–äº†æœºæ„ç®¡ç†æ¨¡å—çš„å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬ï¼š

### 11.1 æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… **åŠŸèƒ½æµ‹è¯•**ï¼šCRUDæ“ä½œçš„å®Œæ•´æµ‹è¯•è¦†ç›–
- âœ… **å­—æ®µéªŒè¯**ï¼šæ‰€æœ‰å­—æ®µçš„éªŒè¯è§„åˆ™å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•
- âœ… **è‡ªåŠ¨åŒ–è®¾è®¡**ï¼šå®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬å’Œæ¡†æ¶
- âœ… **è¾¹ç•Œæµ‹è¯•**ï¼šå­—æ®µé•¿åº¦ã€ç‰¹æ®Šå­—ç¬¦ã€å¿…å¡«é¡¹ç­‰è¾¹ç•Œæ¡ä»¶
- âœ… **æ•°æ®å…³è”**ï¼šæœºæ„ä¸äººå‘˜ã€éƒ¨é—¨ç­‰æ¨¡å—çš„å…³è”å…³ç³»éªŒè¯
- âœ… **æ€§èƒ½æµ‹è¯•**ï¼šå¤§æ•°æ®é‡ä¸‹çš„æ“ä½œå“åº”æ—¶é—´æµ‹è¯•

### 11.2 æµ‹è¯•ç”¨ä¾‹ç»Ÿè®¡
- **æ€»è®¡**ï¼š20ä¸ªè¯¦ç»†æµ‹è¯•ç”¨ä¾‹
- **åŠŸèƒ½æµ‹è¯•**ï¼š14ä¸ªç”¨ä¾‹ï¼ˆæ–°å¢4ä¸ªã€æŸ¥è¯¢2ä¸ªã€ç¼–è¾‘2ä¸ªã€åˆ é™¤2ä¸ªã€å…³è”2ä¸ªã€æƒé™2ä¸ªï¼‰
- **æ€§èƒ½æµ‹è¯•**ï¼š2ä¸ªç”¨ä¾‹
- **å®‰å…¨æµ‹è¯•**ï¼š4ä¸ªç”¨ä¾‹

### 11.3 è‡ªåŠ¨åŒ–è„šæœ¬
- **APIæµ‹è¯•è„šæœ¬**ï¼šåŸºäºJestå’ŒAxiosçš„å®Œæ•´APIæµ‹è¯•å¥—ä»¶
- **UIæµ‹è¯•è„šæœ¬**ï¼šåŸºäºSelenium WebDriverçš„å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•è„šæœ¬**ï¼šåŸºäºArtillery.jsçš„æ€§èƒ½æµ‹è¯•é…ç½®
- **æ•°æ®åº“æµ‹è¯•**ï¼šå®Œæ•´çš„æµ‹è¯•æ•°æ®å‡†å¤‡å’Œæ¸…ç†è„šæœ¬

### 11.4 æŒç»­é›†æˆ
- **GitHub Actions**ï¼šå®Œæ•´çš„CI/CDæµæ°´çº¿é…ç½®
- **Jenkins Pipeline**ï¼šä¼ä¸šçº§æŒç»­é›†æˆé…ç½®
- **æµ‹è¯•æŠ¥å‘Š**ï¼šè‡ªåŠ¨åŒ–çš„æµ‹è¯•æŠ¥å‘Šç”Ÿæˆå’Œå‘å¸ƒ

### 11.5 è´¨é‡ä¿è¯
- **ä»£ç è¦†ç›–ç‡**ï¼šç›®æ ‡è¦†ç›–ç‡â‰¥80%
- **æ€§èƒ½æŒ‡æ ‡**ï¼šæ˜ç¡®çš„æ€§èƒ½æµ‹è¯•ç›®æ ‡å’ŒéªŒæ”¶æ ‡å‡†
- **å®‰å…¨æµ‹è¯•**ï¼šSQLæ³¨å…¥ã€XSSæ”»å‡»ç­‰å®‰å…¨æ¼æ´æ£€æµ‹
- **ç¼ºé™·ç®¡ç†**ï¼šå®Œæ•´çš„ç¼ºé™·åˆ†ç±»ã€è·Ÿè¸ªå’Œç®¡ç†æµç¨‹

æœ¬æµ‹è¯•è®¡åˆ’ç¡®ä¿äº†æœºæ„ç®¡ç†åŠŸèƒ½çš„é«˜è´¨é‡äº¤ä»˜ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•æé«˜äº†æµ‹è¯•æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼Œä¸ºç³»ç»Ÿçš„ç¨³å®šè¿è¡Œæä¾›äº†å¯é ä¿éšœã€‚