<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jiuxi.admin.core.mapper.TpTagMapper">

    <!-- 标签表结果映射 -->
    <resultMap type="com.jiuxi.admin.core.bean.entity.TpTag" id="tpTagMap">
        <result property="tagId" column="TAG_ID"/>
        <result property="tagName" column="TAG_NAME"/>
        <result property="tagDesc" column="TAG_DESC"/>
        <result property="tagColor" column="TAG_COLOR"/>
        <result property="orderIndex" column="ORDER_INDEX"/>
        <result property="tenantId" column="TENANT_ID"/>
        <result property="ascnId" column="ASCN_ID"/>
        <result property="actived" column="ACTIVED"/>
        <result property="creator" column="CREATOR"/>
        <result property="createTime" column="CREATE_TIME"/>
        <result property="updator" column="UPDATOR"/>
        <result property="updateTime" column="UPDATE_TIME"/>
        <result property="extend01" column="EXTEND01"/>
        <result property="extend02" column="EXTEND02"/>
        <result property="extend03" column="EXTEND03"/>
    </resultMap>

    <!-- 基础查询SQL -->
    <sql id="baseSql">
        SELECT
            TAG_ID,
            TAG_NAME,
            TAG_DESC,
            TAG_COLOR,
            ORDER_INDEX,
            TENANT_ID,
            ASCN_ID,
            ACTIVED,
            CREATOR,
            CREATE_TIME,
            UPDATOR,
            UPDATE_TIME,
            EXTEND01,
            EXTEND02,
            EXTEND03
        FROM tp_tag
    </sql>

    <!-- 分页查询标签列表 -->
    <select id="getPage" parameterType="com.jiuxi.admin.core.bean.query.TpTagQuery" resultType="com.jiuxi.admin.core.bean.vo.TpTagVO">
        <include refid="baseSql"/>
        <where>
            ACTIVED = 1
            <if test="query.tagName != null and query.tagName != ''">
                AND TAG_NAME LIKE CONCAT('%', #{query.tagName}, '%')
            </if>
            <if test="query.tenantId != null and query.tenantId != ''">
                AND TENANT_ID = #{query.tenantId}
            </if>
            <if test="query.orgId != null and query.orgId != ''">
                AND ASCN_ID = #{query.orgId}
            </if>
        </where>
        ORDER BY ORDER_INDEX ASC, CREATE_TIME DESC
    </select>

    <!-- 查询标签列表 -->
    <select id="getList" parameterType="com.jiuxi.admin.core.bean.query.TpTagQuery" resultType="com.jiuxi.admin.core.bean.vo.TpTagVO">
        <include refid="baseSql"/>
        <where>
            ACTIVED = 1
            <if test="query.tagName != null and query.tagName != ''">
                AND TAG_NAME LIKE CONCAT('%', #{query.tagName}, '%')
            </if>
            <if test="query.tenantId != null and query.tenantId != ''">
                AND TENANT_ID = #{query.tenantId}
            </if>
            <if test="query.orgId != null and query.orgId != ''">
                AND ASCN_ID = #{query.orgId}
            </if>
        </where>
        ORDER BY ORDER_INDEX ASC, CREATE_TIME DESC
    </select>

    <!-- 新增标签 -->
    <insert id="save" parameterType="com.jiuxi.admin.core.bean.entity.TpTag">
        INSERT INTO tp_tag (
            TAG_ID,
            TAG_NAME,
            TAG_DESC,
            TAG_COLOR,
            ORDER_INDEX,
            TENANT_ID,
            ASCN_ID,
            ACTIVED,
            CREATOR,
            CREATE_TIME,
            UPDATOR,
            UPDATE_TIME,
            EXTEND01,
            EXTEND02,
            EXTEND03
        ) VALUES (
            #{tagId},
            #{tagName},
            #{tagDesc},
            #{tagColor},
            #{orderIndex},
            #{tenantId},
            #{ascnId},
            #{actived},
            #{creator},
            #{createTime},
            #{updator},
            #{updateTime},
            #{extend01},
            #{extend02},
            #{extend03}
        )
    </insert>

    <!-- 更新标签 -->
    <update id="update" parameterType="com.jiuxi.admin.core.bean.entity.TpTag">
        UPDATE tp_tag
        <set>
            <if test="tagName != null and tagName != ''">TAG_NAME = #{tagName},</if>
            <if test="tagDesc != null">TAG_DESC = #{tagDesc},</if>
            <if test="tagColor != null">TAG_COLOR = #{tagColor},</if>
            <if test="orderIndex != null">ORDER_INDEX = #{orderIndex},</if>

            <if test="tenantId != null">TENANT_ID = #{tenantId},</if>
            <if test="ascnId != null">ASCN_ID = #{ascnId},</if>
            <if test="actived != null">ACTIVED = #{actived},</if>
            <if test="updator != null">UPDATOR = #{updator},</if>
            <if test="updateTime != null">UPDATE_TIME = #{updateTime},</if>
            <if test="extend01 != null">EXTEND01 = #{extend01},</if>
            <if test="extend02 != null">EXTEND02 = #{extend02},</if>
            <if test="extend03 != null">EXTEND03 = #{extend03}</if>
        </set>
        WHERE TAG_ID = #{tagId}
    </update>

    <!-- 查看标签详情 -->
    <select id="view" parameterType="String" resultType="com.jiuxi.admin.core.bean.vo.TpTagVO">
        <include refid="baseSql"/>
        WHERE TAG_ID = #{tagId} AND ACTIVED = 1
    </select>

    <!-- 删除标签（逻辑删除） -->
    <update id="delete" parameterType="com.jiuxi.admin.core.bean.entity.TpTag">
        UPDATE tp_tag
        SET ACTIVED = 0,
            UPDATOR = #{updator},
            UPDATE_TIME = #{updateTime}
        WHERE TAG_ID = #{tagId}
    </update>

    <!-- 根据标签名称查询标签 -->
    <select id="selectByTagName" resultType="com.jiuxi.admin.core.bean.entity.TpTag">
        <include refid="baseSql"/>
        WHERE TAG_NAME = #{tagName}
          AND TENANT_ID = #{tenantId}
          AND ASCN_ID = #{orgId}
          AND ACTIVED = 1
    </select>

</mapper>